<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test gi·ªçng n√≥i Vi·ªát Nam</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      padding: 20px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      min-height: 100vh;
    }
    .container { 
      max-width: 900px; 
      margin: 0 auto; 
      background: white; 
      padding: 30px; 
      border-radius: 15px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
    }
    h1 { 
      color: #1976d2; 
      text-align: center; 
      margin-bottom: 30px;
      font-size: 28px;
    }
    .voice-item { 
      background: #f8f9fa; 
      padding: 20px; 
      margin: 15px 0; 
      border-radius: 10px; 
      border-left: 5px solid #1976d2; 
      transition: all 0.3s ease;
    }
    .voice-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .voice-name { 
      font-weight: bold; 
      color: #333; 
      font-size: 16px;
      margin-bottom: 5px;
    }
    .voice-lang { 
      color: #666; 
      font-size: 14px; 
      margin-bottom: 10px;
    }
    button { 
      background: #4caf50; 
      color: white; 
      border: none; 
      padding: 10px 20px; 
      border-radius: 6px; 
      cursor: pointer; 
      margin: 5px; 
      font-size: 14px;
      transition: background 0.3s ease;
    }
    button:hover { 
      background: #45a049; 
      transform: translateY(-1px);
    }
    .test-section { 
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5); 
      padding: 25px; 
      border-radius: 12px; 
      margin: 25px 0; 
      border: 1px solid #e0e0e0;
    }
    input[type="text"] { 
      width: 100%; 
      padding: 12px; 
      margin: 15px 0; 
      border: 2px solid #ddd; 
      border-radius: 8px; 
      box-sizing: border-box; 
      font-size: 14px;
    }
    input[type="text"]:focus {
      border-color: #1976d2;
      outline: none;
    }
    .controls { 
      display: flex; 
      gap: 15px; 
      align-items: center; 
      margin: 15px 0; 
      flex-wrap: wrap;
    }
    label { 
      min-width: 80px; 
      font-weight: 500;
    }
    input[type="range"] {
      flex: 1;
      min-width: 100px;
    }
    .section-title {
      color: #1976d2;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-left: 5px solid #f44336;
    }
    .success-message {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-left: 5px solid #4caf50;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé§ Test Gi·ªçng N√≥i Vi·ªát Nam</h1>
    
    <div class="test-section">
      <h3>üéØ Test Nhanh</h3>
      <input type="text" 
             id="testText" 
             value="Xin m·ªùi qu√Ω kh√°ch s·ªë th·ª© t·ª± m·ªôt trƒÉm hai m∆∞·ªùi ba ƒë·∫øn qu·∫ßy s·ªë m·ªôt ƒë·ªÉ th·ª±c hi·ªán th·ªß t·ª•c h√†nh ch√≠nh" 
             placeholder="Nh·∫≠p vƒÉn b·∫£n ƒë·ªÉ test...">
      
      <div class="controls">
        <label>T·ªëc ƒë·ªô:</label>
        <input type="range" id="rateSlider" min="0.1" max="2" step="0.1" value="0.8">
        <span id="rateValue">0.8</span>
      </div>
      
      <div class="controls">
        <label>Cao ƒë·ªô:</label>
        <input type="range" id="pitchSlider" min="0" max="2" step="0.1" value="1.2">
        <span id="pitchValue">1.2</span>
      </div>
      
      <div class="controls">
        <label>√Çm l∆∞·ª£ng:</label>
        <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1">
        <span id="volumeValue">1.0</span>
      </div>
      
      <button onclick="testSelectedVoice()" style="background: #ff9800; font-size: 16px; padding: 12px 24px;">
        üéØ Test v·ªõi gi·ªçng ƒë∆∞·ª£c ch·ªçn
      </button>
      <button onclick="testAllVietnameseVoices()" style="background: #9c27b0; font-size: 16px; padding: 12px 24px;">
        üé≠ Test t·∫•t c·∫£ gi·ªçng Vi·ªát
      </button>
      <button onclick="stopSpeaking()" style="background: #f44336; font-size: 16px; padding: 12px 24px;">
        üõë D·ª´ng ph√°t √¢m
      </button>
      <button onclick="debugVoices()" style="background: #607d8b; font-size: 16px; padding: 12px 24px;">
        üîç Debug gi·ªçng n√≥i
      </button>
    </div>

    <h3 class="section-title">üìã Danh s√°ch t·∫•t c·∫£ gi·ªçng n√≥i c√≥ s·∫µn</h3>
    <div id="voicesList">
      <div style="text-align: center; padding: 20px; color: #666;">
        üîÑ ƒêang t·∫£i danh s√°ch gi·ªçng n√≥i...
      </div>
    </div>

    <h3 class="section-title">üáªüá≥ Gi·ªçng n·ªØ Vi·ªát Nam ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t</h3>
    <div id="vietnameseVoices">
      <div style="text-align: center; padding: 20px; color: #666;">
        üîç ƒêang t√¨m gi·ªçng n·ªØ Vi·ªát Nam...
      </div>
    </div>
  </div>

  <script>
    let allVoices = [];
    let selectedVoice = null;

    // C·∫≠p nh·∫≠t gi√° tr·ªã slider
    function setupSliders() {
      const rateSlider = document.getElementById('rateSlider');
      const pitchSlider = document.getElementById('pitchSlider');
      const volumeSlider = document.getElementById('volumeSlider');
      
      rateSlider.addEventListener('input', (e) => {
        document.getElementById('rateValue').textContent = e.target.value;
      });
      
      pitchSlider.addEventListener('input', (e) => {
        document.getElementById('pitchValue').textContent = e.target.value;
      });
      
      volumeSlider.addEventListener('input', (e) => {
        document.getElementById('volumeValue').textContent = e.target.value;
      });
    }

    function loadVoices() {
      try {
        allVoices = speechSynthesis.getVoices();
        
        if (allVoices.length === 0) {
          setTimeout(loadVoices, 200);
          return;
        }

        console.log('‚úÖ ƒê√£ t·∫£i', allVoices.length, 'gi·ªçng n√≥i');
        displayAllVoices();
        displayVietnameseVoices();
        
      } catch (error) {
        console.error('L·ªói khi t·∫£i gi·ªçng n√≥i:', error);
        showError('Kh√¥ng th·ªÉ t·∫£i danh s√°ch gi·ªçng n√≥i');
      }
    }

    function displayAllVoices() {
      const container = document.getElementById('voicesList');
      
      if (allVoices.length === 0) {
        container.innerHTML = '<div class="error-message">‚ùå Kh√¥ng t√¨m th·∫•y gi·ªçng n√≥i n√†o</div>';
        return;
      }

      const voicesHtml = allVoices.map((voice, index) => `
        <div class="voice-item">
          <div class="voice-name">${voice.name}</div>
          <div class="voice-lang">
            üåê ${voice.lang} | 
            üìç ${voice.localService ? 'C·ª•c b·ªô' : 'Tr·ª±c tuy·∫øn'} | 
            ${voice.default ? '‚≠ê M·∫∑c ƒë·ªãnh' : ''}
          </div>
          <button onclick="testVoice(${index})">üéµ Test</button>
          <button onclick="selectVoice(${index})" style="background: #2196f3;">‚úÖ Ch·ªçn</button>
        </div>
      `).join('');
      
      container.innerHTML = voicesHtml;
    }

    function displayVietnameseVoices() {
      const container = document.getElementById('vietnameseVoices');
      
      const vietnameseVoices = allVoices.filter(voice => 
        voice.lang.toLowerCase().includes('vi') || 
        voice.name.toLowerCase().includes('vietnam') ||
        voice.name.toLowerCase().includes('vietnamese')
      );

      if (vietnameseVoices.length === 0) {
        container.innerHTML = '<div class="error-message">‚ùå Kh√¥ng t√¨m th·∫•y gi·ªçng Vi·ªát Nam n√†o</div>';
        return;
      }

      const voicesHtml = vietnameseVoices.map(voice => {
        const originalIndex = allVoices.indexOf(voice);
        const isMale = voice.name.toLowerCase().includes('male') || 
                      voice.name.toLowerCase().includes('nam') ||
                      voice.name.toLowerCase().includes('man');
        const isFemale = voice.name.toLowerCase().includes('female') || 
                        voice.name.toLowerCase().includes('n·ªØ') ||
                        voice.name.toLowerCase().includes('woman') ||
                        voice.name.toLowerCase().includes('girl');
        
        const genderIcon = isFemale ? 'üë©' : (isMale ? 'üë®' : 'üé≠');
        const genderText = isFemale ? '(N·ªØ)' : (isMale ? '(Nam)' : '');
        const borderColor = isFemale ? '#e91e63' : (isMale ? '#1976d2' : '#4caf50');
        
        return `
          <div class="voice-item" style="border-left-color: ${borderColor};">
            <div class="voice-name">${genderIcon} ${voice.name} ${genderText}</div>
            <div class="voice-lang">üåê ${voice.lang} | üìç ${voice.localService ? 'C·ª•c b·ªô' : 'Tr·ª±c tuy·∫øn'}</div>
            <button onclick="testVoice(${originalIndex})">üéµ Test</button>
            <button onclick="selectVoice(${originalIndex})" style="background: ${borderColor};">
              ‚≠ê Ch·ªçn l√†m m·∫∑c ƒë·ªãnh
            </button>
          </div>
        `;
      }).join('');
      
      container.innerHTML = voicesHtml;

      // T·ª± ƒë·ªông ch·ªçn gi·ªçng n·ªØ ƒë·∫ßu ti√™n
      const femaleVoice = vietnameseVoices.find(voice => 
        voice.name.toLowerCase().includes('female') || 
        voice.name.toLowerCase().includes('n·ªØ') ||
        voice.name.toLowerCase().includes('woman')
      ) || vietnameseVoices[0];
      
      if (femaleVoice) {
        selectedVoice = femaleVoice;
        console.log('üéØ ƒê√£ ch·ªçn gi·ªçng m·∫∑c ƒë·ªãnh:', femaleVoice.name);
      }
    }

    function testVoice(voiceIndex) {
      try {
        const voice = allVoices[voiceIndex];
        const text = document.getElementById('testText').value || "Xin ch√†o, ƒë√¢y l√† test gi·ªçng n√≥i";
        
        speechSynthesis.cancel(); // D·ª´ng ph√°t √¢m tr∆∞·ªõc ƒë√≥
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.voice = voice;
        utterance.lang = voice.lang || 'vi-VN';
        utterance.rate = parseFloat(document.getElementById('rateSlider').value);
        utterance.pitch = parseFloat(document.getElementById('pitchSlider').value);
        utterance.volume = parseFloat(document.getElementById('volumeSlider').value);
        
        utterance.onstart = () => {
          console.log('üéµ B·∫Øt ƒë·∫ßu ph√°t:', voice.name);
        };
        
        utterance.onend = () => {
          console.log('‚úÖ Ho√†n th√†nh ph√°t:', voice.name);
        };
        
        utterance.onerror = (event) => {
          console.error('‚ùå L·ªói ph√°t √¢m:', event.error);
          showError('L·ªói khi ph√°t √¢m: ' + event.error);
        };
        
        speechSynthesis.speak(utterance);
        
      } catch (error) {
        console.error('L·ªói test gi·ªçng:', error);
        showError('Kh√¥ng th·ªÉ test gi·ªçng n√≥i n√†y');
      }
    }

    function selectVoice(voiceIndex) {
      selectedVoice = allVoices[voiceIndex];
      showSuccess(`‚úÖ ƒê√£ ch·ªçn gi·ªçng: ${selectedVoice.name} (${selectedVoice.lang})`);
    }

    function testSelectedVoice() {
      if (!selectedVoice) {
        showError('‚ùå Vui l√≤ng ch·ªçn m·ªôt gi·ªçng n√≥i tr∆∞·ªõc');
        return;
      }
      
      const voiceIndex = allVoices.indexOf(selectedVoice);
      testVoice(voiceIndex);
    }

    function testAllVietnameseVoices() {
      const vietnameseVoices = allVoices.filter(voice => 
        voice.lang.toLowerCase().includes('vi') || 
        voice.name.toLowerCase().includes('vietnam') ||
        voice.name.toLowerCase().includes('vietnamese')
      );
      
      if (vietnameseVoices.length === 0) {
        showError('‚ùå Kh√¥ng t√¨m th·∫•y gi·ªçng Vi·ªát Nam n√†o');
        return;
      }
      
      const text = document.getElementById('testText').value || 
                   "Xin m·ªùi qu√Ω kh√°ch s·ªë th·ª© t·ª± m·ªôt trƒÉm hai m∆∞·ªùi ba ƒë·∫øn qu·∫ßy s·ªë m·ªôt ƒë·ªÉ th·ª±c hi·ªán th·ªß t·ª•c h√†nh ch√≠nh";
      
      showSuccess(`üé≠ ƒêang test ${vietnameseVoices.length} gi·ªçng Vi·ªát Nam...`);
      
      // Log chi ti·∫øt c√°c gi·ªçng ƒë·ªÉ debug
      console.log('üîç Danh s√°ch gi·ªçng Vi·ªát Nam:', vietnameseVoices.map(v => ({
        name: v.name,
        lang: v.lang,
        localService: v.localService
      })));
      
      vietnameseVoices.forEach((voice, index) => {
        setTimeout(() => {
          console.log(`üéµ Test gi·ªçng ${index + 1}/${vietnameseVoices.length}:`, voice.name);
          
          const utterance = new SpeechSynthesisUtterance(`Gi·ªçng s·ªë ${index + 1}: ${text}`);
          utterance.voice = voice;
          utterance.lang = voice.lang || 'vi-VN';
          utterance.rate = 0.7;
          utterance.pitch = 1.3;
          utterance.volume = 1.0;
          
          speechSynthesis.speak(utterance);
        }, index * 5000); // M·ªói gi·ªçng c√°ch nhau 5 gi√¢y
      });
    }

    function debugVoices() {
      console.log('üîç DEBUG: T·∫•t c·∫£ gi·ªçng n√≥i c√≥ s·∫µn:');
      allVoices.forEach((voice, index) => {
        console.log(`${index + 1}. ${voice.name} | ${voice.lang} | ${voice.localService ? 'Local' : 'Remote'}`);
      });
      
      const vietnameseVoices = allVoices.filter(voice => 
        voice.lang.toLowerCase().includes('vi') || 
        voice.name.toLowerCase().includes('vietnam') ||
        voice.name.toLowerCase().includes('vietnamese')
      );
      
      console.log('üáªüá≥ Gi·ªçng Vi·ªát Nam t√¨m th·∫•y:', vietnameseVoices.length);
      vietnameseVoices.forEach((voice, index) => {
        console.log(`üé§ ${index + 1}. ${voice.name} | ${voice.lang}`);
      });
    }

    function stopSpeaking() {
      speechSynthesis.cancel();
      showSuccess('üõë ƒê√£ d·ª´ng t·∫•t c·∫£ ph√°t √¢m');
    }

    function showError(message) {
      const container = document.querySelector('.container');
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.innerHTML = message;
      container.insertBefore(errorDiv, container.firstChild);
      
      setTimeout(() => {
        if (errorDiv.parentNode) {
          errorDiv.parentNode.removeChild(errorDiv);
        }
      }, 5000);
    }

    function showSuccess(message) {
      const container = document.querySelector('.container');
      const successDiv = document.createElement('div');
      successDiv.className = 'success-message';
      successDiv.innerHTML = message;
      container.insertBefore(successDiv, container.firstChild);
      
      setTimeout(() => {
        if (successDiv.parentNode) {
          successDiv.parentNode.removeChild(successDiv);
        }
      }, 3000);
    }

    // Kh·ªüi t·∫°o khi trang load
    document.addEventListener('DOMContentLoaded', function() {
      setupSliders();
      loadVoices();
      
      // L·∫Øng nghe s·ª± ki·ªán voices changed
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
      }
    });
  </script>
</body>
</html>
